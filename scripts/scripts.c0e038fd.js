"use strict";angular.module("yoQsevefco2App",["ngAnimate","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngMaterial","hmTouchEvents"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/home",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/presqu-accident/:presId",{templateUrl:"views/presqu-accident.html",controller:"PresquAccidentCtrl"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","dbService",function(a,b,c){a.username="",a.isLogined=!1,a.logout=function(){a.loggedUser=null,a.isLogined=!1,b.path("/login")},a.$on("$routeChangeStart",function(c,d,e){null==a.loggedUser&&("view/login.html"==d.templateUrl||b.path("/"))}),c.dbDef(),c.dbInit().then(function(a){})}]);var isMobile={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return isMobile.Android()||isMobile.BlackBerry()||isMobile.iOS()||isMobile.Opera()||isMobile.Windows()}};isMobile.Android()&&document.write("<script src=cordova.js></script>"),angular.module("yoQsevefco2App").controller("MainCtrl",["$scope","$location",function(a,b){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],a.gotoPresqu=function(){b.path("/presqu-accident/0")}}]),angular.module("yoQsevefco2App").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("yoQsevefco2App").controller("LoginCtrl",["$rootScope","$scope","$location",function(a,b,c){b.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],b.user={username:"DavidNgv.Nguyen",password:"123456"},b.login=function(){var d=b.user;a.loggedUser=d,a.username=d.username,a.isLogined=!0,c.path("/home")}}]),angular.module("yoQsevefco2App").controller("PresquAccidentCtrl",["$scope","$location","$routeParams","dbService","$mdToast","$mdSidenav",function(a,b,c,d,e,f){if(a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],a.closeSidenav=function(){f("left").close()},a.openSidenav=function(){f("left").open()},a.toggleLeft=function(){f("left").toggle()},a.loadFromDatabase=function(b){var c=a,e=d.getDb();e.Presquaccidents.find(b).then(function(a){for(var b=a.Image1,d=b.split("|"),e=[],f=0;f<d.length;f++)e.push({path:d[f]});c.$apply(function(){c.presqu={date:a.ReportDate,lieu:a.Lieu,desc:a.Desc,action:a.Action},c.imageInfo=e})},function(a){console.log(a.message)})},a.savePres=function(){var b=a;0==b.presId?b.insertRecord():b.editRecord(b.presId)},a.editRecord=function(b){var c=a,f=d.getDb();f.Presquaccidents.find(b).then(function(a){f.Presquaccidents.attach(a),a.ReportDate=c.presqu.date,a.Lieu=c.presqu.lieu,a.Desc=c.presqu.desc,a.Action=c.presqu.action,f.saveChanges().then(function(){e.show(e.simple().content("Envoyeur").hideDelay(500)),setTimeout(function(){c.$apply(function(){c.goHome()})},700)})})},a.insertRecord=function(){for(var b=a,c=d.getDb(),f="",g=b.imageInfo.length,h=0;g>h;h++){var i=b.imageInfo[h].path;""!=f?f+="|"+i:f=i}var j={ReportDate:b.presqu.date,Lieu:b.presqu.lieu,Desc:b.presqu.desc,Action:b.presqu.action,Image1:f},k=new Presquaccident(j);c.add(k),c.saveChanges().then(function(){k.Id;e.show(e.simple().content("Envoyeur").hideDelay(400)),setTimeout(function(){b.$apply(function(){b.goHome()})},700)})},a.loadItemList=function(){var b=d.getDb(),c=a;c.itemList=[],b.Presquaccidents.filter(function(a){return!0}).forEach(function(a){var b={id:a.Id,desc:a.Desc};c.itemList.push(b),a.Id==c.presId&&(c.selected=b)})},a.selectItem=function(b){a.selected=b;var c=b.id;a.goPresqu(c)},a.goHome=function(){b.path("/home")},a.goPresqu=function(a){b.path("/presqu-accident/"+a)},a.takePicturePress=0,a.takePicture=function(){var b={quality:45,destinationType:Camera.DestinationType.FILE_URI,encodingType:Camera.EncodingType.JPEG,sourceType:Camera.PictureSourceType.CAMERA,correctOrientation:!0};a.takePicturePress++,1==a.takePicturePress&&window.navigator.camera.getPicture(a.camOk,function(a){console.log(a)},b)},a.camOk=function(b){a.takePicturePress=0;var c=a;e.show(e.simple().content("Processing image").hideDelay(0)),c.copyImage(b)},a.copyImage=function(b){var c=a;try{async.waterfall([function(a){window.resolveLocalFileSystemURL(b,function(b){var c=b.name;a(!1,b,c)},function(b){a(b,!1)})},function(a,b,c){window.resolveLocalFileSystemURL(cordova.file.dataDirectory,function(d){c(!1,a,b,d)},function(a){c(a,!1)})},function(a,b,c,d){a.copyTo(c,b,function(){d(!1,b)},function(a){d(a,!1)})},function(a,b){navigator.geolocation.getCurrentPosition(function(c){b(!1,a,c)},function(a){b(a,!1)})}],function(a,b,d){if(a)alert(a);else{var f=cordova.file.dataDirectory+b;c.$apply(function(){c.imageInfo.push({path:f,lat:d.coords.latitude,"long":d.coords.longitude})}),e.hide()}})}catch(d){alert(d.message),e.hide()}},a.loadItemList(),a.presId=c.presId,a.presId>0)a.loadFromDatabase(a.presId);else{var g=new Date;a.presqu={date:g,lieu:"",desc:"",action:""},a.imageInfo=[]}}]),angular.module("yoQsevefco2App").service("dbService",["$q",function(a){var b;return{dbDef:function(){$data.Entity.extend("Presquaccident",{Id:{type:"int",key:!0,computed:!0},ReportDate:{type:Date},Lieu:{type:String,required:!0,maxLength:100},Desc:{type:String,required:!0,maxLength:255},Action:{type:String,required:!0,maxLength:255},Image1:{type:String}}),$data.EntityContext.extend("QseVefcoDatabase",{Presquaccidents:{type:$data.EntitySet,elementType:Presquaccident}})},dbInit:function(){var c=a.defer();return b=new QseVefcoDatabase("QseVefcoDatabase"),b.onReady(function(){console.log("db ready to use"),c.resolve(b)}),c.promise},getDb:function(){return b}}}]);